version: 2
jobs:
  build:
    docker:
      - image: circleci/node:10
    steps:
      - checkout
      - restore_cache:
          key: dependency-cache-{{ checksum "yarn.lock" }}
      - run:
          name: install
          command: yarn
      - save_cache:
          key: dependency-cache-{{ checksum "yarn.lock" }}
          paths:
            - ./node_modules
      - run:
          name: add .env
          command: |
            echo "REACT_APP_FIREBASE_CONFIG=$REACT_APP_FIREBASE_CONFIG" > .env
            echo "REACT_APP_REDIRECT_URI=$REACT_APP_REDIRECT_URI" > .env
            echo "REACT_APP_SPOTIFY_CLIENT_ID=$REACT_APP_SPOTIFY_CLIENT_ID" > .env
      - run:
          name: test
          command: yarn test # CIの場合、CI=trueのオプションが自動付与されwatch外れるっぽい

workflows: # 定義したJobを流すフローを指定
  version: 2
  install_and_test: # 任意のフロー名でOK
    jobs: # 以下、実行Jobを順番に記述
      - build: # 上述のJob名
          filters:
            branches:
              only: master # filtersでmasterブランチへのコミットのみを対象にflowを動かすように指定
